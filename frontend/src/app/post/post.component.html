<ng-container *ngIf="!!post; else noPost">
    <img [src]="image" onerror="this.style.display='none'">

    <form name="post-controls" (ngSubmit)="deletePost()"><button (click)="deletePost()">Delete post</button>
        <div class="alert alert-warning" *ngIf="f.submitted && isPostDeletionFailed">
            Post deletion failed!<br />{{ postCommentErrorMessage }}
        </div>
        <div class="alert alert-success" *ngIf="postDeletionIsSuccessful">
            Your post deletion is successful!
        </div>
    </form>

    <h2>{{ post?.title }}</h2>
    <p>{{ post?.body }}</p>
</ng-container>

<ng-template #noPost>
    <h3 *ngIf="!isLoadingPost; else loadingPost">Sorry, but this post doesn't exist.</h3>
</ng-template>

<ng-template #loadingPost>
    <h3>Loading Post...</h3>
</ng-template>


<hr>
<h4>Comment Section</h4>
<section>
    <ng-container *ngFor="let postComment of postComments">
        <div class="plain-row flex-content-to-the-right margin-above">
            <button (click)="deleteComment(postComment)">Delete</button>
        </div>
        <p>{{ postComment?.content }}</p>
        <div class="plain-row flex-content-to-the-right margin-below">
            <div class="likes {{ postComment?.opinion === 'liked' ? 'active' : '' }}">
                <button (click)="likeComment(postComment)"><span>{{ postComment?.likes }}</span> Like</button>
            </div>
            <div class="dislikes {{ postComment?.opinion === 'disliked' ? 'active' : '' }}">
                <button (click)="dislikeComment(postComment)"><span>{{ postComment?.dislikes }}</span> Dislike</button>
            </div>
        </div>
    </ng-container>

    <ng-template #noComments>
        <h6 *ngIf="!isLoadingPostComments; else loadingComments">No comments.</h6>
    </ng-template>

    <ng-template #loadingComments>
        <h5>Loading Comments...</h5>
    </ng-template>
</section>

<form
name="form"
(ngSubmit)="f.form.valid && onSubmit()"
#f="ngForm"
novalidate
>
    <textarea
    id="post-comment"
    type="text"
    class="form-control"
    name="content"
    [(ngModel)]="form.content"
    required
    maxlength="512"
    #content="ngModel"
    (input)="postCommentServerErrors.content = null"></textarea>
    <div class="alert-danger" *ngIf="(content.errors && f.submitted) || postCommentServerErrors.content">
        <div *ngIf="content?.errors?.['required'] && isSubmitCommentFailed">Content is required</div>
        <div *ngIf="content?.errors?.['maxlength']">
            Comment must be at most 512 characters
        </div>
        <ng-container *ngIf="postCommentServerErrors.content">
        <div *ngFor="let error of postCommentServerErrors.content;">{{ error }}</div>
        </ng-container>
    </div>

    <div class="alert alert-warning" *ngIf="f.submitted && isSubmitCommentFailed">
        Comment upload failed!<br />{{ postCommentErrorMessage }}
    </div>
    <div class="alert alert-success" *ngIf="postCommentUploadIsSuccessful">
        Your post comment upload is successful!
    </div>

    <button style="margin-top: 2vh;" id="btn-submit-post">Submit comment</button>
</form>
